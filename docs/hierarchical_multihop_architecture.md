# åˆ†å±‚å¤šè·³é—®ç­”æ¶æ„è¯¦è§£

## ğŸ“ æ•´ä½“æ¶æ„

### ç³»ç»Ÿç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AgentExecutionEngine                         â”‚
â”‚                   (åè°ƒå’Œæ‰§è¡Œå¼•æ“)                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        HierarchicalMultiHopAgent (åè°ƒå™¨)                 â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚  Summary Agent   â”‚         â”‚ Reasoning Agent  â”‚       â”‚ â”‚
â”‚  â”‚  â”‚   (æ¨¡å‹1)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚    (æ¨¡å‹2)       â”‚       â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚         â”‚                  â”‚       â”‚ â”‚
â”‚  â”‚  â”‚ è¾“å…¥: å†å²æ¶ˆæ¯    â”‚         â”‚ è¾“å…¥: å‹ç¼©æ‘˜è¦    â”‚       â”‚ â”‚
â”‚  â”‚  â”‚ è¾“å‡º: å‹ç¼©æ‘˜è¦    â”‚         â”‚ è¾“å‡º: å·¥å…·è°ƒç”¨    â”‚       â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚         â”‚                  â”‚       â”‚ â”‚
â”‚  â”‚  â”‚ Prompt:          â”‚         â”‚ Tools:           â”‚       â”‚ â”‚
â”‚  â”‚  â”‚ - æ‘˜è¦æŒ‡ä»¤       â”‚         â”‚ - local_search   â”‚       â”‚ â”‚
â”‚  â”‚  â”‚ - æ ¼å¼è¦æ±‚       â”‚         â”‚ - finish         â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚  â”‚           â–²                            â”‚                 â”‚ â”‚
â”‚  â”‚           â”‚                            â–¼                 â”‚ â”‚
â”‚  â”‚           â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ è§¦å‘æ¡ä»¶æ£€æŸ¥  â”‚          â”‚ â”‚
â”‚  â”‚                                â”‚              â”‚          â”‚ â”‚
â”‚  â”‚                                â”‚ â€¢ Token > N  â”‚          â”‚ â”‚
â”‚  â”‚                                â”‚ â€¢ Steps > M  â”‚          â”‚ â”‚
â”‚  â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   ToolEnvironment                         â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚ Tool Execution â”‚         â”‚ Reward Functionâ”‚           â”‚ â”‚
â”‚  â”‚  â”‚                â”‚         â”‚                â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ å¹¶è¡Œæ‰§è¡Œ     â”‚         â”‚ â€¢ F1 Score     â”‚           â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ æ ¼å¼åŒ–è¾“å‡º   â”‚         â”‚ â€¢ Exact Match  â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ‰§è¡Œæµç¨‹

### å®Œæ•´çš„äº¤äº’å¾ªç¯

```
[1] åˆå§‹åŒ–
    â”œâ”€ åˆ›å»º Reasoning Agent
    â”œâ”€ åˆ›å»º Summary Agent
    â”œâ”€ è®¾ç½®å‹ç¼©é˜ˆå€¼
    â””â”€ åŠ è½½ç³»ç»Ÿæç¤ºè¯

[2] æ¥æ”¶é—®é¢˜
    â””â”€ Environment.reset()
        â””â”€ è¿”å›: {"question": "..."}

[3] Reasoning Agent æ¨ç†å¾ªç¯
    â”‚
    â”œâ”€ [æ­¥éª¤ 1]
    â”‚   â”œâ”€ Modelç”Ÿæˆå“åº” â†’ "è°ƒç”¨local_search('Barack Obama')"
    â”‚   â”œâ”€ è§£æå·¥å…·è°ƒç”¨
    â”‚   â”œâ”€ Environmentæ‰§è¡Œ â†’ è¿”å›æœç´¢ç»“æœ
    â”‚   â”œâ”€ æ›´æ–°æ¶ˆæ¯å†å²
    â”‚   â””â”€ steps_since_compress++
    â”‚
    â”œâ”€ [æ­¥éª¤ 2]
    â”‚   â”œâ”€ Modelç”Ÿæˆå“åº” â†’ "è°ƒç”¨local_search('Michelle Obama')"
    â”‚   â”œâ”€ æ‰§è¡Œæœç´¢
    â”‚   â””â”€ steps_since_compress++
    â”‚
    â”œâ”€ [æ­¥éª¤ 3]
    â”‚   â”œâ”€ Modelç”Ÿæˆå“åº” â†’ "ç»§ç»­æ¨ç†..."
    â”‚   â””â”€ steps_since_compress++ (ç°åœ¨ = 3)
    â”‚
    â””â”€ [æ£€æŸ¥å‹ç¼©æ¡ä»¶]
        â””â”€ steps_since_compress >= max_steps_before_compress
            â””â”€ è§¦å‘å‹ç¼©! âœ“

[4] å‹ç¼©æµç¨‹
    â”‚
    â”œâ”€ [å‡†å¤‡å‹ç¼©]
    â”‚   â”œâ”€ æ”¶é›† Reasoning Agent çš„æ‰€æœ‰æ¶ˆæ¯
    â”‚   â”œâ”€ æ„å»ºå‹ç¼©è¯·æ±‚
    â”‚   â””â”€ è®¾ç½® waiting_for_summary = True
    â”‚
    â”œâ”€ [Summary Agent ç”Ÿæˆ]
    â”‚   â”œâ”€ è¾“å…¥: å†å²æ¶ˆæ¯åˆ—è¡¨
    â”‚   â”œâ”€ Modelç”Ÿæˆæ‘˜è¦
    â”‚   â””â”€ è¾“å‡º: ç»“æ„åŒ–æ‘˜è¦
    â”‚
    â””â”€ [åº”ç”¨å‹ç¼©]
        â”œâ”€ æå–æ‘˜è¦å†…å®¹
        â”œâ”€ ä¿å­˜åˆ° compression_history
        â”œâ”€ é‡ç½® Reasoning Agent
        â”œâ”€ æ³¨å…¥å‹ç¼©æ‘˜è¦ä¸ºç³»ç»Ÿæ¶ˆæ¯
        â”œâ”€ é‡æ–°åŠ è½½å½“å‰é—®é¢˜
        â””â”€ steps_since_compress = 0

[5] ç»§ç»­æ¨ç†ï¼ˆåŸºäºå‹ç¼©ä¸Šä¸‹æ–‡ï¼‰
    â”‚
    â”œâ”€ [æ­¥éª¤ 4]
    â”‚   â”œâ”€ Reasoning Agent ç°åœ¨çš„ä¸Šä¸‹æ–‡:
    â”‚   â”‚   â””â”€ System: åŸå§‹æç¤ºè¯ + å·¥å…·å®šä¹‰
    â”‚   â”‚   â””â”€ System: å‹ç¼©æ‘˜è¦
    â”‚   â”‚   â””â”€ User: å½“å‰é—®é¢˜
    â”‚   â”œâ”€ ModelåŸºäºæ‘˜è¦ç”Ÿæˆå“åº”
    â”‚   â””â”€ ç»§ç»­æœç´¢æˆ–æ¨ç†
    â”‚
    â””â”€ [æœ€ç»ˆç­”æ¡ˆ]
        â”œâ”€ Modelç”Ÿæˆ: "finish({'response': '\\boxed{Barack Obama}'})"
        â”œâ”€ Environmentè¯„ä¼°ç­”æ¡ˆ
        â””â”€ è¿”å›å¥–åŠ±

[6] ç»“æŸ
    â””â”€ ä¿å­˜å®Œæ•´çš„ Trajectory
        â”œâ”€ æ‰€æœ‰æ¨ç†æ­¥éª¤
        â”œâ”€ æ‰€æœ‰å‹ç¼©è®°å½•
        â””â”€ æœ€ç»ˆå¥–åŠ±
```

## ğŸ§© æ ¸å¿ƒç±»è¯¦è§£

### 1. SummaryAgent

**èŒè´£ï¼š** å‹ç¼©å†å²ä¸Šä¸‹æ–‡

```python
class SummaryAgent(BaseAgent):
    """
    å‹ç¼©å†å²å¯¹è¯çš„Agent
    """

    # æ ¸å¿ƒæ–¹æ³•
    def prepare_summarization_request(self, history_messages):
        """å‡†å¤‡æ‘˜è¦è¯·æ±‚"""
        # 1. è¿‡æ»¤æ¶ˆæ¯ï¼ˆåªä¿ç•™user/assistant/toolï¼‰
        # 2. æ ¼å¼åŒ–ä¸ºJSON
        # 3. æ„å»ºå‹ç¼©è¯·æ±‚

    def update_from_model(self, response):
        """å¤„ç†æ¨¡å‹ç”Ÿæˆçš„æ‘˜è¦"""
        # 1. æ¥æ”¶æ‘˜è¦
        # 2. è®°å½•åˆ°trajectory
        # 3. è¿”å›Action

    def extract_summary(self, response):
        """æå–ç»“æ„åŒ–æ‘˜è¦"""
        # 1. å°è¯•æå–```summary```ä»£ç å—
        # 2. å¦‚æœæ²¡æœ‰ï¼Œè¿”å›æ•´ä¸ªå“åº”
```

**è¾“å…¥ç¤ºä¾‹ï¼š**
```json
[
  {"role": "user", "content": "Who is older..."},
  {"role": "assistant", "content": "I'll search for..."},
  {"role": "tool", "content": "Barack Obama born 1961..."},
  {"role": "assistant", "content": "Now searching for Michelle..."},
  {"role": "tool", "content": "Michelle Obama born 1964..."}
]
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```markdown
## Key Facts:
- Barack Obama: born August 4, 1961
- Michelle Obama: born January 17, 1964

## Entity Relationships:
- Both are married
- Barack is 3 years older

## Reasoning Progress:
- Searched for both birthdates
- Found: Barack (1961), Michelle (1964)
- Still need to compare and answer

## Compressed Context:
We searched for birthdates: Barack Obama (1961) and Michelle Obama (1964).
Barack is older by 3 years. Need to formulate final answer.
```

### 2. ReasoningAgent

**èŒè´£ï¼š** åŸºäºä¸Šä¸‹æ–‡è¿›è¡Œæ¨ç†å’Œæœç´¢

```python
class ReasoningAgent(BaseAgent):
    """
    æ¨ç†å’Œæœç´¢Agent
    """

    # æ ¸å¿ƒæ–¹æ³•
    def inject_compressed_context(self, compressed_summary):
        """æ³¨å…¥å‹ç¼©çš„ä¸Šä¸‹æ–‡"""
        # 1. ä¿å­˜æ‘˜è¦
        # 2. æ„å»ºcontext_message
        # 3. æ’å…¥åˆ°æ¶ˆæ¯å†å²ä¸­

    def update_from_model(self, response):
        """å¤„ç†æ¨¡å‹å“åº”"""
        # 1. è§£æå·¥å…·è°ƒç”¨
        # 2. å¦‚æœæ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè‡ªåŠ¨æ·»åŠ finish
        # 3. æ›´æ–°æ¶ˆæ¯å’Œtrajectory

    def estimate_token_count(self):
        """ä¼°ç®—å½“å‰tokenæ•°"""
        # ç²—ç•¥ä¼°è®¡ï¼šå­—ç¬¦æ•° / 4
```

**æ¶ˆæ¯å†å²ç¤ºä¾‹ï¼ˆæ³¨å…¥æ‘˜è¦åï¼‰ï¼š**
```python
[
  {
    "role": "system",
    "content": "You are a reasoning agent..."
  },
  {
    "role": "system",
    "content": "## Compressed Context:\n[æ‘˜è¦å†…å®¹]\n---\nContinue reasoning..."
  },
  {
    "role": "user",
    "content": "Who is older..."
  }
]
```

### 3. HierarchicalMultiHopAgent

**èŒè´£ï¼š** åè°ƒä¸¤ä¸ªæ¨¡å‹çš„äº¤äº’

```python
class HierarchicalMultiHopAgent(BaseAgent):
    """
    åˆ†å±‚åè°ƒå™¨
    """

    # çŠ¶æ€ç®¡ç†
    self.reasoning_agent: ReasoningAgent
    self.summary_agent: SummaryAgent
    self.compression_count: int
    self.steps_since_last_compress: int
    self.waiting_for_summary: bool

    # æ ¸å¿ƒæ–¹æ³•
    def should_compress(self) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥å‹ç¼©"""
        # 1. æ£€æŸ¥enable_compression
        # 2. è®¡ç®—å½“å‰tokens
        # 3. æ£€æŸ¥steps
        # 4. æ ¹æ®triggeræ¨¡å¼è¿”å›

    def trigger_compression(self) -> str:
        """è§¦å‘å‹ç¼©"""
        # 1. è·å–å†å²æ¶ˆæ¯
        # 2. å‡†å¤‡å‹ç¼©è¯·æ±‚
        # 3. è®¾ç½®waiting_for_summary = True
        # 4. è¿”å›è¯·æ±‚

    def apply_compression(self, summary):
        """åº”ç”¨å‹ç¼©"""
        # 1. æå–æ‘˜è¦
        # 2. ä¿å­˜å†å²
        # 3. é‡ç½®Reasoning Agent
        # 4. æ³¨å…¥æ‘˜è¦

    @property
    def chat_completions(self):
        """åŠ¨æ€è¿”å›æ¶ˆæ¯"""
        if self.waiting_for_summary:
            return # Summary Agentæ¶ˆæ¯
        elif self.should_compress():
            # è§¦å‘å‹ç¼©ï¼Œè¿”å›Summaryè¯·æ±‚
        else:
            return # Reasoning Agentæ¶ˆæ¯
```

## ğŸ›ï¸ é…ç½®é€‰é¡¹è¯¦è§£

### å‹ç¼©è§¦å‘æ¡ä»¶

| é…ç½® | å«ä¹‰ | ç¤ºä¾‹åœºæ™¯ |
|------|------|---------|
| `compression_trigger="token"` | ä»…å½“tokens > Næ—¶å‹ç¼© | é•¿æ–‡æ¡£ä»»åŠ¡ |
| `compression_trigger="step"` | ä»…å½“steps > Mæ—¶å‹ç¼© | å›ºå®šæ­¥æ•°å‹ç¼© |
| `compression_trigger="both"` | æ»¡è¶³ä»»ä¸€æ¡ä»¶å³å‹ç¼© | **æ¨èé»˜è®¤** |

### å‚æ•°è°ƒä¼˜æŒ‡å—

#### ç®€å•é—®é¢˜ï¼ˆ2-3è·³ï¼‰
```python
max_tokens_before_compress = 2000
max_steps_before_compress = 2
max_summary_length = 200
```

#### ä¸­ç­‰å¤æ‚åº¦ï¼ˆ4-6è·³ï¼‰
```python
max_tokens_before_compress = 3000
max_steps_before_compress = 3
max_summary_length = 300
```

#### å¤æ‚é—®é¢˜ï¼ˆ7+è·³ï¼‰
```python
max_tokens_before_compress = 4000
max_steps_before_compress = 4
max_summary_length = 500
```

## ğŸ”¬ è®­ç»ƒç­–ç•¥

### æ¨¡å¼1: è”åˆè®­ç»ƒï¼ˆJoint Trainingï¼‰

**é€‚ç”¨åœºæ™¯ï¼š** ä»å¤´è®­ç»ƒæ–°æ¨¡å‹

```python
trainer = AgentTrainer(
    agent_class=HierarchicalMultiHopAgent,
    agent_args={
        "enable_compression": True,
        # ä¸¤ä¸ªæ¨¡å‹éƒ½ä¼šè¢«è®­ç»ƒ
    }
)
```

**ä¼˜ç‚¹ï¼š**
- ç«¯åˆ°ç«¯ä¼˜åŒ–
- Summaryå’ŒReasoningååŒå­¦ä¹ 
- æ‘˜è¦æ›´é€‚åˆåç»­æ¨ç†

**ç¼ºç‚¹ï¼š**
- è®­ç»ƒå¤æ‚åº¦é«˜
- éœ€è¦æ›´å¤šGPUèµ„æº
- æ”¶æ•›å¯èƒ½è¾ƒæ…¢

### æ¨¡å¼2: åˆ†é˜¶æ®µè®­ç»ƒï¼ˆStaged Trainingï¼‰

#### é˜¶æ®µ1: è®­ç»ƒSummary Agent
```python
# ç¬¬ä¸€é˜¶æ®µï¼šåªè®­ç»ƒæ‘˜è¦èƒ½åŠ›
trainer = AgentTrainer(
    agent_args={
        "mode": "summary_only",
        # ä½¿ç”¨å›ºå®šçš„Reasoning Agent
    }
)
```

#### é˜¶æ®µ2: è®­ç»ƒReasoning Agent
```python
# ç¬¬äºŒé˜¶æ®µï¼šåŸºäºè®­ç»ƒå¥½çš„Summaryè®­ç»ƒReasoning
trainer = AgentTrainer(
    agent_args={
        "mode": "reasoning_only",
        # åŠ è½½è®­ç»ƒå¥½çš„Summary Agent
        "summary_model_path": "path/to/summary/model",
    }
)
```

**ä¼˜ç‚¹ï¼š**
- æ¯ä¸ªé˜¶æ®µç›®æ ‡æ˜ç¡®
- æ˜“äºè°ƒè¯•å’Œä¼˜åŒ–
- å¯ä»¥é‡å¤ä¼˜åŒ–æŸä¸€éƒ¨åˆ†

**ç¼ºç‚¹ï¼š**
- éœ€è¦åˆ†ä¸¤æ¬¡è®­ç»ƒ
- å¯èƒ½ä¸æ˜¯å…¨å±€æœ€ä¼˜

### æ¨¡å¼3: è¿ç§»å­¦ä¹ ï¼ˆTransfer Learningï¼‰

```python
# ä½¿ç”¨é¢„è®­ç»ƒçš„é€šç”¨æ¨¡å‹åˆå§‹åŒ–
summary_agent = SummaryAgent(
    pretrained_model="Qwen2.5-7B-Instruct"
)
reasoning_agent = ReasoningAgent(
    pretrained_model="Qwen2.5-7B-Instruct"
)

# åœ¨å¤šè·³æ•°æ®ä¸Šå¾®è°ƒ
trainer.train()
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ä¼˜åŒ–

1. **é™åˆ¶å†å²é•¿åº¦**
```python
max_tokens_before_compress = 2000  # æ›´æ¿€è¿›çš„å‹ç¼©
```

2. **æ¢¯åº¦æ£€æŸ¥ç‚¹**
```python
config.trainer.gradient_checkpointing = True
```

3. **æ··åˆç²¾åº¦è®­ç»ƒ**
```python
config.trainer.fp16 = True
```

### é€Ÿåº¦ä¼˜åŒ–

1. **å¹¶è¡ŒAgent**
```python
n_parallel_agents = 64  # å¢åŠ å¹¶è¡Œåº¦
```

2. **æ‰¹å¤„ç†**
```python
config.data.train_batch_size = 16
```

3. **å¼‚æ­¥å·¥å…·è°ƒç”¨**
- å·²é»˜è®¤å¯ç”¨ï¼ˆThreadPoolExecutorï¼‰

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. å¯è§†åŒ–å‹ç¼©è¿‡ç¨‹

```python
import logging
logging.basicConfig(level=logging.INFO)

# ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# INFO: Triggering compression #1 (steps since last: 3)
# INFO: Applied compression #1 (summary length: 245 chars)
```

### 2. æ£€æŸ¥æ‘˜è¦è´¨é‡

```python
# è·å–å‹ç¼©å†å²
stats = agent.get_stats()
print(stats["compression_history_count"])

# æŸ¥çœ‹å®é™…æ‘˜è¦
for i, summary in enumerate(agent.compression_history):
    print(f"\n=== Compression {i+1} ===")
    print(summary)
```

### 3. éªŒè¯å·¥å…·è°ƒç”¨

```python
# è®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨
for step in trajectory.steps:
    action = step.action
    if isinstance(action, list):
        for call in action:
            print(f"Tool: {call['function']['name']}")
            print(f"Args: {call['function']['arguments']}")
```

## ğŸ”® æœªæ¥æ‰©å±•

### 1. å¤šçº§å‹ç¼©

```python
# å‹ç¼©çš„å‹ç¼©
if compression_count > 5:
    # å‹ç¼©æ‰€æœ‰å†å²æ‘˜è¦ä¸ºä¸€ä¸ªè¶…çº§æ‘˜è¦
    meta_summary = compress_compression_history()
```

### 2. é€‰æ‹©æ€§å‹ç¼©

```python
# åªå‹ç¼©ä¸é‡è¦çš„éƒ¨åˆ†ï¼Œä¿ç•™å…³é”®ä¿¡æ¯
def should_compress_message(msg):
    if is_critical_fact(msg):
        return False  # ä¸å‹ç¼©
    return True
```

### 3. åŠ¨æ€å‹ç¼©ç‡

```python
# æ ¹æ®å‰©ä½™æ­¥æ•°è°ƒæ•´å‹ç¼©å¼ºåº¦
remaining_steps = max_steps - current_step
compression_ratio = min(0.3, remaining_steps / max_steps)
```

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. **Memory Compression in LLMs**
   - é•¿ä¸Šä¸‹æ–‡é—®é¢˜çš„è®°å¿†ç®¡ç†

2. **Multi-Hop QA Datasets**
   - HotpotQA
   - 2WikiMultiHopQA

3. **Tool-Using Agents**
   - ReAct: Reasoning and Acting
   - Toolformer

---

**ç»´æŠ¤è€…ï¼š** RLLM Team
**æœ€åæ›´æ–°ï¼š** 2025-10-26
